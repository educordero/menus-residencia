
   <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Menús Residencias</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    input, select { padding: 0.5em; margin: 0.5em 0; }
    ul { padding: 0; list-style: none; }
    li { margin: 0.5em 0; }
    .menu-item a { text-decoration: none; color: blue; }
  </style>
</head>
<body>
  <h1>Consulta de Menús por Residencia</h1>
  <input type="text" id="buscador" placeholder="Buscar residencia..." />
  <select id="provincia">
    <option value="">Todas las provincias</option>
  </select>
  <ul id="resultados"></ul>
  <div id="menusCentro" style="margin-top: 2em;"></div>
  <img src="Logo.png" alt="Logo Aramark" style="position: absolute; top: 20px; right: 20px; height: 40px;">

  <script>
    let data = [];
    fetch('centros.json')
      .then(response => response.json())
      .then(json => {
        data = json;
        cargarProvincias();
        filtrar();
        restaurarDesdeHash();
      });

    const buscador = document.getElementById('buscador');
    const provincia = document.getElementById('provincia');
    const resultados = document.getElementById('resultados');

    buscador.addEventListener('input', filtrar);
    provincia.addEventListener('change', filtrar);

    function cargarProvincias() {
      const provincias = [...new Set(data.map(d => d.provincia))];
      provincias.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p;
        opt.textContent = p;
        provincia.appendChild(opt);
      });
    }

    function filtrar() {
      const texto = buscador.value.toLowerCase();
      const filtroProvincia = provincia.value;
      resultados.innerHTML = '';
      document.getElementById('menusCentro').innerHTML = '';

      let resultadosFiltrados = data
        .filter(d => d.nombre.toLowerCase().includes(texto))
        .filter(d => !filtroProvincia || d.provincia === filtroProvincia);

      resultadosFiltrados.forEach(d => {
        const li = document.createElement('li');
        const boton = document.createElement('button');
        boton.textContent = `${d.nombre} (${d.provincia})`;
        boton.onclick = () => mostrarMenus(d);
        li.appendChild(boton);
        resultados.appendChild(li);
      });
    }

    function mostrarMenus(centro) {
      const contenedor = document.getElementById('menusCentro');
      contenedor.innerHTML = `<h2>Menús disponibles para ${centro.nombre}</h2>`;
      const ul = document.createElement('ul');
      centro.menus.forEach(m => {
        const li = document.createElement('li');
        li.className = 'menu-item';
        li.innerHTML = `<a href="${m.url}" target="_blank">${m.nombre}</a>`;
        ul.appendChild(li);
      });
      contenedor.appendChild(ul);
      history.pushState({ centro }, '', `#${encodeURIComponent(centro.nombre)}`);
    }

    function restaurarDesdeHash() {
      const hash = decodeURIComponent(location.hash.substring(1));
      if (!hash) return;
      const centro = data.find(d => d.nombre === hash);
      if (centro) {
        mostrarMenus(centro);
        buscador.value = '';
        provincia.value = centro.provincia;
        filtrar();
      }
    }

    window.addEventListener('popstate', restaurarDesdeHash);
  </script>
</body>
</html>
